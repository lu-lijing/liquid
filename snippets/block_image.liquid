<style>
  #block-{{ block.id }} .block {
    display: flex;
    justify-content: {{ block.settings.image_align_mobile }};
  }
  #block-{{ block.id }} .image {
    width: 100%;
    overflow: hidden;
    {% if block.settings.image_width != "" %}
      width: {{ block.settings.image_width | remove: "px" | append: "px" }};
    {% endif %}
    border-radius: {{ block.settings.image_border_radius | append: "px" }};
  }
  #block-{{ block.id }} .image__image {
    width: 100%;
    {% if block.settings.image_width != "" %}
      width: {{ block.settings.image_width | remove: "px" | append: "px" }};
    {% endif %}
  }
  #block-{{ block.id }} .image__overlay {
    {% if block.settings.always_show_on_mobile %}
      opacity: 1;
    {% else %}
      opacity: 0;
    {% endif %}
    background-color: {{ block.settings.overlay_background_color }};
    border-radius: {{ block.settings.image_border_radius | append: "px" }};
  }
  #block-{{ block.id }} .image__overlay-text {
    color: {{ block.settings.overlay_text_color }} !important;
  }
  @media (min-width: 768px) {
    #block-{{ block.id }} .block {
        display: flex;
        justify-content: {{ block.settings.image_align_desktop }};
    }
    #block-{{ block.id }} .image__overlay {
      opacity: 0;
    }
    #block-{{ block.id }} .image__overlay:hover {
      opacity: 1;
    }
  }
  {% if block.settings.image_first %}
    @media (max-width: 767px) {
      #block-{{ block.id }} {
        -webkit-box-ordinal-group: 0;
        -ms-flex-order: -1;
        order: -1;
      }
    }
  {% endif %}
</style>

<div class="image">
  {% if block.settings.gallery %}
    {% if block.settings.enable_overlay %}
      <a href="{{ block.settings.image | image_picker_url: 'placeholder.png' }}">
    {% else %}
      <a href="{{ block.settings.image | image_picker_url: 'placeholder.png' }}" data-fancybox="{{section.id}}" data-caption="{{ block.settings.image_caption }}">
    {% endif %}
      <img class="image__image" src="{{ block.settings.image | image_picker_url: 'placeholder.png' }}" alt="{{ block.settings.image_alt }}" />
    </a>
    {% if block.settings.enable_overlay %}
      <a href="{{ block.settings.image | image_picker_url: 'placeholder.png' }}" data-fancybox="{{section.id}}" data-caption="{{ block.settings.image_caption }}" class="image__overlay background-{{ block.settings.overlay_background_color | color_scheme_class }}">
        <h4 class="image__overlay-text">
          {{ block.settings.overlay_text }}
        </h4>
      </a>
    {% endif %}
  {% else %}
    {% if block.settings.img_action != blank %}
      <a class="image__link" href="{{ block.settings.img_action }}" {% if block.settings.img_action == "#two-step" %} data-target="#two-step" data-toggle="modal" {% endif %} {% if block.settings.new_tab == true %} target="_blank" rel="noopener" {% endif %}>
    {% endif %}
        <img class="image__image" src="{{ block.settings.image | image_picker_url: 'placeholder.png' }}" kjb-settings-id="{{ 'image' | settings_id: section: section, block: block }}" alt="{{ block.settings.image_alt }}" />
    {% if block.settings.img_action != blank %}
      </a>
    {% endif %}
    {% if block.settings.enable_overlay %}
      {% if block.settings.img_action != blank %}
        <a href="{{ block.settings.img_action }}" {% if block.settings.img_action == "#two-step" %} data-target="#two-step" data-toggle="modal" {% endif %} {% if block.settings.new_tab == true %} target="_blank" rel="noopener" {% endif %} class="image__overlay background-{{ block.settings.overlay_background_color | color_scheme_class }}">
      {% else %}
        <div class="image__overlay background-{{ block.settings.overlay_background_color | color_scheme_class }}">
      {% endif %}
        <h4 class="image__overlay-text">
          {{ block.settings.overlay_text }}
        </h4>
      {% if block.settings.img_action != blank %}
        </a>
      {% else %}
        </div>
      {% endif %}
    {% endif %}
  {% endif %}
</div>
